<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="js/bundles/common_chunks.bundle.js"></script>
    <script src="js/bundles/markup.bundle.js"></script>
    <script src="js/bundles/data.bundle.js"></script>
    <script src="js/bundles/base_plugin.bundle.js"></script>
    <script src="js/bundles/sbadmin2.bundle.js"></script>

    <script>
      const get_headers = () => {
        const stdHeaders = [
          { css: "public/saltcorn.css" },
          { script: "public/saltcorn.js" },
        ];
        return [...stdHeaders];
      };

      const wrap = (title, contents, state) => {
        const bodyClass = "";
        const alerts = [];
        const role_id = 1;
        const role = role_id;
        const layout = state.getLayout({ role_id: role_id });

        const wrappedIn = layout.wrap({
          title,
          brand: {},
          menu: [],
          alerts,
          body: contents.above.join(""),
          headers: get_headers(),
          role,
          bodyClass,
        });
        return wrappedIn;
      };

      document.addEventListener("deviceready", async () => {
        await saltcorn.data.db.init();
        const state = saltcorn.data.state.getState();
        await state.refresh_tables();
        await state.refresh_views();
        state.registerPlugin("base", saltcorn.base_plugin);
        state.registerPlugin("sbadmin2", saltcorn.sbadmin2);
        const views = await saltcorn.data.models.View.find({
          name: "ListTodosB",
        });
        for (const view of views) {
          const contents = await view.run_possibly_on_page({}, {}, {});
          let help = { above: [contents] };
          document.getElementById("content-div").innerHTML = wrap(
            "Todos",
            help,
            state
          );
        }
      });
    </script>
  </head>

  <body>
    <div id="content-div"></div>
  </body>
</html>
